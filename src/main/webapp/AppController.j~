/*
 * AppController.j
 * CappuccinoDwr
 *
 * Created by You on April 9, 2010.
 * Copyright 2010, Your Company All rights reserved.
 */

@import <Foundation/CPObject.j>


@implementation AppController : CPObject
{
	CPTextField label1, label2, label3;
	CPTextField sessionValue;
	CPString _textShadowColor;
	CGSize _textShadowOffset;
}

- (void)applicationDidFinishLaunching:(CPNotification)aNotification
{
    var theWindow = [[CPWindow alloc] initWithContentRect:CGRectMakeZero() styleMask:CPBorderlessBridgeWindowMask],
        contentView = [theWindow contentView];

		[theWindow setBackgroundColor:[CPColor lightGrayColor]];

		_textShadowColor = [CPString stringWithString:@"#ccc"];
//		textShadowOffset = CGSizeMake(0, 1);

		var strButton = [[CPButton alloc] initWithFrame:CGRectMake(10, 10, 0, 0)];
		[strButton setTitle:@"Fetch Server Data"];
		[strButton sizeToFit];
		[strButton setTarget:self];
		[strButton setAction:@selector(fetchData:)];

		label1 = [[CPTextField alloc] initWithFrame:CGRectMake(10, CGRectGetHeight([strButton bounds])+20, 200, 100)];
		[label1 setTextShadowColor:@"#ccc"];
//		[label1 setTextShadowOffset:textShadowOffset];

		label2 = [[CPTextField alloc] initWithFrame:CGRectMake(10, CGRectGetHeight([strButton bounds])+40, 0, 0)];
		[label2 setTextShadowColor:@"#ccc"];
//		[label2 setTextShadowOffset:textShadowOffset];

		label3 = [[CPTextField alloc] initWithFrame:CGRectMake(10, CGRectGetHeight([strButton bounds])+60, 0, 0)];
		[label3 setTextShadowColor:@"#ccc"];
//		[label3 setTextShadowOffset:textShadowOffset];

		sessionValue = [[CPTextField alloc] initWithFrame:CGRectMake(10, CGRectGetHeight([strButton bounds])+240, 100, 30)];
		[sessionValue setEditable:YES];
		[sessionValue setEnabled:YES];
		[sessionValue setBezeled:YES];
		[sessionValue setBezelStyle:CPTextFieldRoundedBezel];
//		[sessionValue setBordered:YES];
		
		var strButton2 = [[CPButton alloc] initWithFrame:CGRectMake(CGRectGetWidth([sessionValue bounds])+10, CGRectGetHeight([sessionValue bounds])+240, 0, 0)];
		[strButton2 setTitle:@"Set Session Attribute"];
		[strButton2 sizeToFit];
		[strButton2 setTarget:self];
		[strButton2 setAction:@selector(setServerSession:)];

		var strButton3 = [[CPButton alloc] initWithFrame:CGRectMake(10, CGRectGetHeight([sessionValue bounds])+295, 0, 0)];
		[strButton3 setTitle:@"Invalidate Session"];
		[strButton3 sizeToFit];
		[strButton3 setTarget:self];
		[strButton3 setAction:@selector(invalidateSession:)];

		[contentView addSubview:strButton];
		[contentView addSubview:label1];
		[contentView addSubview:label2];
		[contentView addSubview:label3];

		[contentView addSubview:sessionValue];
 		[contentView addSubview:strButton2];
		[contentView addSubview:strButton3];

	[theWindow orderFront:self];

    // Uncomment the following line to turn on the standard menu bar.
    //[CPMenu setMenuBarVisible:YES];
}

- (void)invalidateSession:(id)sender
{
	DwrInterface.invalidateSession();
}

- (void)setServerSession:(id)sender
{
	DwrInterface.setServerSession([sessionValue stringValue]);
}

- (void)fetchData:(id)sender
{
	DwrInterface.myObject(function(data) {
		if (data) {
			[label1 setStringValue:data.aString];
			[label1 setTextColor:data.color];
			[label1 sizeToFit];	

			[label2 setStringValue:"Now is " + data.now];
			[label2 setTextColor:data.color];
			[label2 sizeToFit];

			[self display];
		}

//		var json = [CPString JSONFromObject:data];
//		alert(json);
		
  });

	DwrInterface.servletContext(function(data) {
		if (data) {
			[label3 setStringValue:data];
			[label3 sizeToFit];

			[self display];
		}
	});

}

- (void)display
{
	[[CPRunLoop currentRunLoop] limitDateForMode:CPDefaultRunLoopMode];
}

@end
